{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file:///Users/shantanukumar/Poshan/app/api/medichatgemini/route.ts"],"sourcesContent":["import { queryPineconeVectorStore } from \"@/utils\";\nimport { Pinecone } from \"@pinecone-database/pinecone\";\nimport { createGoogleGenerativeAI } from '@ai-sdk/google';\nimport { generateText, Message, StreamData, streamText } from \"ai\";\nimport { NextResponse } from 'next/server';\n\n// Allow streaming responses up to 30 seconds\nexport const maxDuration = 60;\n\n// const pinecone = new Pinecone({\n//     apiKey: process.env.PINECONE_API_KEY ?? \"\",\n// });\n\nconst google = createGoogleGenerativeAI({\n    baseURL: 'https://generativelanguage.googleapis.com/v1beta',\n    apiKey: process.env.GOOGLE_API_KEY\n});\n\nconst model = google('models/gemini-1.5-pro', {\n    safetySettings: [\n        { category: 'HARM_CATEGORY_DANGEROUS_CONTENT', threshold: 'BLOCK_NONE' }\n    ],\n});\n\nexport async function POST(req: Request) {\n    try {\n        const reqBody = await req.json();\n        console.log(reqBody);\n\n        const messages: Message[] = reqBody.messages;\n        const userQuestion = `${messages[messages.length - 1].content}`;\n\n        const reportData: string = reqBody.data.reportData;\n        const query = `Represent this for searching relevant passages: patient medical report says: \\n${reportData}. \\n\\n${userQuestion}`;\n\n        // const retrievals = await queryPineconeVectorStore(pinecone, 'index-one', \"testspace\", query);\n\n        const finalPrompt = `Here is a summary of a patient's clinical report, and a user query. Some generic clinical findings are also provided that may or may not be relevant for the report.\n        Go through the clinical report and answer the user query.\n        Ensure the response is factually accurate, and demonstrates a thorough understanding of the query topic and the clinical report.\n        Before answering you may enrich your knowledge by going through the provided clinical findings. \n        The clinical findings are generic insights and not part of the patient's medical report. Do not include any clinical finding if it is not relevant for the patient's case.\n\n        \\n\\n**Patient's Clinical report summary:** \\n${reportData}. \n        \\n**end of patient's clinical report** \n\n        \\n\\n**User Query:**\\n${userQuestion}?\n        \\n**end of user query** \n\n        \\n\\nProvide thorough justification for your answer.\n        \\n\\n**Answer:**\n        `;\n\n        const data = new StreamData();\n        // data.append({\n        //     retrievals: retrievals\n        // });\n\n        const result = await streamText({\n            model: model,\n            prompt: finalPrompt,\n            onFinish() {\n                data.close();\n            }\n        });\n\n        return result.toDataStreamResponse({ data });\n    } catch (error) {\n        console.error('Error in POST handler:', error);\n        return NextResponse.json({ error: 'Internal Server Error' }, { status: 500 });\n    }\n}"],"names":[],"mappings":";;;;AAIA;AAFA;AACA;;;;AAIO,MAAM,cAAc;AAE3B,kCAAkC;AAClC,kDAAkD;AAClD,MAAM;AAEN,MAAM,SAAS,CAAA,GAAA,yJAAA,CAAA,2BAAwB,AAAD,EAAE;IACpC,SAAS;IACT,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACtC;AAEA,MAAM,QAAQ,OAAO,yBAAyB;IAC1C,gBAAgB;QACZ;YAAE,UAAU;YAAmC,WAAW;QAAa;KAC1E;AACL;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,UAAU,MAAM,IAAI,IAAI;QAC9B,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAsB,QAAQ,QAAQ;QAC5C,MAAM,eAAe,GAAG,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE,CAAC,OAAO,EAAE;QAE/D,MAAM,aAAqB,QAAQ,IAAI,CAAC,UAAU;QAClD,MAAM,QAAQ,CAAC,+EAA+E,EAAE,WAAW,MAAM,EAAE,cAAc;QAEjI,gGAAgG;QAEhG,MAAM,cAAc,CAAC;;;;;;qDAMwB,EAAE,WAAW;;;6BAGrC,EAAE,aAAa;;;;;QAKpC,CAAC;QAED,MAAM,OAAO,IAAI,sJAAA,CAAA,aAAU;QAC3B,gBAAgB;QAChB,6BAA6B;QAC7B,MAAM;QAEN,MAAM,SAAS,MAAM,CAAA,GAAA,sJAAA,CAAA,aAAU,AAAD,EAAE;YAC5B,OAAO;YACP,QAAQ;YACR;gBACI,KAAK,KAAK;YACd;QACJ;QAEA,OAAO,OAAO,oBAAoB,CAAC;YAAE;QAAK;IAC9C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}